<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.inogard.enio.agent.mappers.quot.QuotFileMapper">
  <sql id="sqlSelect">
    SELECT qf.rfq_no, 
           qf.quot_rev, 
           qf.cus_cd, 
           qf.file_seq, 
           qf.file_no 
    FROM   agt_quotfile qf 
  </sql>
  
  <select id="findByRfqNoAndQuotRevAndCusCd" resultType="quotSrv">
    <include refid="sqlSelect"/>
    <![CDATA[
      WHERE  qf.rfq_no = #{rfqNo}
      AND qf.quot_rev = #{quotRev}
      AND qf.cus_cd = #{cusCd}
    ]]>
  </select>
  
  <insert id="addQuotFile" parameterType="QuotFile">
    <selectKey resultType="string" keyProperty="fileSeq" order="BEFORE">
		<![CDATA[
			SELECT RIGHT('00000' + CONVERT(VARCHAR, ISNULL(MAX(qf.file_seq), '00000') + 1), 5) AS fileSeq 
              FROM   agt_quotfile qf 
              WHERE  qf.rfq_no = #{rfqNo} 
                     AND qf.quot_rev = #{quotRev} 
                     AND qf.cus_cd = #{cusCd} 
		]]>
    </selectKey>
		<![CDATA[
		INSERT INTO agt_quotfile (
      rfq_no, 
      quot_rev, 
      cus_cd, 
      file_seq, 
      file_no
    ) VALUES (
      #{rfqNo}, 
      #{quotRev}, 
      #{cusCd}, 
      #{fileSeq}, 
      #{fileNo}
    ) 
		]]>
  </insert>
</mapper>